<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Provider Subscribe</title>
<link rel="icon" href="/public/favicon.png">
<style>body{font-family:Arial,Helvetica,sans-serif;background:#f5f7fb;margin:0}.card{max-width:560px;margin:40px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}</style>
</head><body>
<div class="card">
  <img src="/public/logo-full.svg" style="height:56px;display:block;margin:0 auto 12px">
  <h2>Provider Subscription</h2>
  <label>Full name</label><br><input id="name" style="width:100%;padding:8px;margin-bottom:8px"><br>
  <label>Email</label><br><input id="email" style="width:100%;padding:8px;margin-bottom:8px"><br>
  <label>Phone</label><br><input id="phone" style="width:100%;padding:8px;margin-bottom:12px"><br>
  <button id="subscribeNow" style="background:#ff7a00;color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer">Subscribe Now</button>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { firebaseConfig } from "/src/firebaseConfig.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById('subscribeNow').addEventListener('click', async ()=>{
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  if(!name||!email){ alert('Please enter name and email'); return; }
  try{
    const docRef = await addDoc(collection(db,'providers'), { name, email, phone, createdAt: serverTimestamp(), paid:false });
    const providerId = docRef.id;
    const res = await fetch('/.netlify/functions/createPaymentLink', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ providerId, type:'subscription' }) });
    const data = await res.json();
    if(data && data.url){ window.location.href = data.url; } else { alert('Payment link error'); }
  }catch(e){ alert('Error: '+e.message); }
});
</script>
</body></html>
